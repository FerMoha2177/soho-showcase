!function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){return s(e[r][1][t]||t)},u,u.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){e.exports={settings:{animate:!0,scaleToView:!0,scaleToFit:!0,hotkeys:!1,playbackRate:"throttle"}}},{}],2:[function(t,e,i){class n{constructor(t,e){this.width=t,this.height=e,this.padding=50,this.bounds=this.calculateBounds()}calculateBounds(){const t=Math.min(this.width-2*this.padding,.8*this.width),e=Math.min(this.height-2*this.padding,.8*this.height);return{x:(this.width-t)/2,y:(this.height-e)/2,width:t,height:e}}getRandomSpawnX(t=50){return this.bounds.x+t+Math.random()*(this.bounds.width-2*t)}getSpawnY(t=50){return this.bounds.y+this.bounds.height-t}handleCollisions(t){}render2D(t){}}class s extends n{constructor(t,e){super(t,e),this.type="popcorn-maker"}handleCollisions(t){t.y+t.currentRadius>this.bounds.y+this.bounds.height&&(t.y=this.bounds.y+this.bounds.height-t.currentRadius,t.velocityY*=-t.bounce),t.x-t.currentRadius<this.bounds.x&&(t.x=this.bounds.x+t.currentRadius,t.velocityX*=-t.bounce),t.x+t.currentRadius>this.bounds.x+this.bounds.width&&(t.x=this.bounds.x+this.bounds.width-t.currentRadius,t.velocityX*=-t.bounce)}render2D(t){t.strokeStyle="#666",t.lineWidth=4,t.beginPath(),t.moveTo(this.bounds.x,this.bounds.y),t.lineTo(this.bounds.x,this.bounds.y+this.bounds.height),t.lineTo(this.bounds.x+this.bounds.width,this.bounds.y+this.bounds.height),t.lineTo(this.bounds.x+this.bounds.width,this.bounds.y),t.stroke(),t.fillStyle="#888";t.fillRect(this.bounds.x-4,this.bounds.y+this.bounds.height-4,8,8),t.fillRect(this.bounds.x+this.bounds.width-4,this.bounds.y+this.bounds.height-4,8,8),t.fillRect(this.bounds.x-4,this.bounds.y-4,8,8),t.fillRect(this.bounds.x+this.bounds.width-4,this.bounds.y-4,8,8)}}class o extends n{constructor(t,e){super(t,e),this.type="migration-path"}handleCollisions(t){super.handleCollisions&&super.handleCollisions(t)}render2D(t){t.strokeStyle="#444",t.lineWidth=2,t.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}}class r extends n{constructor(t,e){super(t,e),this.type="current-climate"}handleCollisions(t){super.handleCollisions&&super.handleCollisions(t)}render2D(t){t.strokeStyle="#444",t.lineWidth=2,t.strokeRect(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)}}e.exports={BaseContainer:n,PopcornMakerContainer:s,MigrationPathContainer:o,CurrentClimateContainer:r,createContainer:function(t,e,i){switch(t){case"popcorn-maker":return new s(e,i);case"migration-path":return new o(e,i);case"current-climate":return new r(e,i);default:return new n(e,i)}}}},{}],3:[function(t,e,i){const n={Fear:"#DC2626",Anger:"#DC2626",Sadness:"#1D4ED8",Numbness:"#6B7280",Anxiety:"#7C3AED",Guilt:"#059669",Denial:"#000000",Disappointment:"#F59E0B",Excitement:"#F59E0B",Relief:"#1D4ED8",Hope:"#059669"};e.exports={emotionColors:n,reasonsForLeaving:[{word:"Lack\nof\nOpportunity",color:[.1,.1,.1],responses:12},{word:"Corrupt Government",color:[.1,.1,.1],responses:6},{word:"Violence",color:[.1,.1,.1],responses:4},{word:"Economic Instability",color:[.1,.1,.1],responses:4},{word:"Police Brutality",color:[.1,.1,.1],responses:2},{word:"Decay of Educational System",color:[.1,.1,.1],responses:2},{word:"Lack of Freedom of Speech",color:[.1,.1,.1],responses:2},{word:"Disinformation",color:[.1,.1,.1],responses:1},{word:"Decay of Healthcare System",color:[.1,.1,.1],responses:1}],emotionsDuringImmigration:[{word:"Hope",color:n.Hope,responses:15},{word:"Fear",color:n.Fear,responses:12},{word:"Anxiety",color:n.Anxiety,responses:8},{word:"Relief",color:n.Relief,responses:6},{word:"Excitement",color:n.Excitement,responses:5},{word:"Sadness",color:n.Sadness,responses:5},{word:"Anger",color:n.Anger,responses:4},{word:"Guilt",color:n.Guilt,responses:3}],currentClimateEmotions:[{word:"Concerned",color:[.9,.4,.2],responses:18},{word:"Hopeful",color:[.5,.8,.3],responses:12},{word:"Frustrated",color:[.8,.2,.4],responses:10}]}},{}],4:[function(t,e,i){const n=t("canvas-sketch"),s=t("./phases/phase1-reasons-for-leaving"),{settings:o}=t("./config/settings");n(({width:t,height:e})=>{console.log("Sketch initialized with 2D context:",{width:t,height:e});const i=new s(t,e);const n=t=>{i&&i.handleKeyPress&&i.handleKeyPress(t.key)};return document.addEventListener("keydown",n),{render({context:t,time:e,width:n,height:s}){i&&i.render&&i.render({context:t,time:e-0,width:n,height:s})},resize({width:t,height:e}){i&&(i.width=t,i.height=e,i.container&&(i.container.width=t,i.container.height=e))},unload(){document.removeEventListener("keydown",n),i&&i.destroy&&i.destroy()}}},o)},{"./config/settings":1,"./phases/phase1-reasons-for-leaving":6,"canvas-sketch":5}],5:[function(t,e,i){(function(t){(function(){!function(t,n){"object"==typeof i&&void 0!==e?e.exports=n():"function"==typeof define&&define.amd?define(n):t.canvasSketch=n()}(this,function(){var e=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;var s=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,s){for(var o,r,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),h=1;h<arguments.length;h++){for(var c in o=Object(arguments[h]))i.call(o,c)&&(a[c]=o[c]);if(e){r=e(o);for(var u=0;u<r.length;u++)n.call(o,r[u])&&(a[r[u]]=o[r[u]])}}return a},o="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function r(t,e){return t(e={exports:{}},e.exports),e.exports}var a=o.performance&&o.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},h=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then};var c=function(t){return!(!t||"object"!=typeof t)&&("object"==typeof window&&"object"==typeof window.Node?t instanceof window.Node:"number"==typeof t.nodeType&&"string"==typeof t.nodeName)};function u(){return"undefined"!=typeof window&&window["canvas-sketch-cli"]}function l(){for(var t=arguments,e=0;e<arguments.length;e++)if(null!=t[e])return t[e]}function p(){return"undefined"!=typeof document}function d(t){return t&&"function"==typeof t.save&&"function"==typeof t.scale&&"function"==typeof t.restore}var f,m=r(function(t,e){function i(t){var e=[];for(var i in t)e.push(i);return e}(t.exports="function"==typeof Object.keys?Object.keys:i).shim=i}),g=r(function(t,e){var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function s(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=i?n:s).supported=n,e.unsupported=s}),y=r(function(t){var e=Array.prototype.slice,i=t.exports=function(t,o,r){return r||(r={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?r.strict?t===o:t==o:function(t,o,r){var a,h;if(n(t)||n(o))return!1;if(t.prototype!==o.prototype)return!1;if(g(t))return!!g(o)&&(t=e.call(t),o=e.call(o),i(t,o,r));if(s(t)){if(!s(o))return!1;if(t.length!==o.length)return!1;for(a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0}try{var c=m(t),u=m(o)}catch(t){return!1}if(c.length!=u.length)return!1;for(c.sort(),u.sort(),a=c.length-1;a>=0;a--)if(c[a]!=u[a])return!1;for(a=c.length-1;a>=0;a--)if(!i(t[h=c[a]],o[h],r))return!1;return typeof t==typeof o}(t,o,r))};function n(t){return null==t}function s(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}}),b=r(function(t,e){!function(){var e,i,n,s=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,function(t,r,a,h){if(1!==arguments.length||"string"!==(null===(c=t)?"null":void 0===c?"undefined":"object"!=typeof c?typeof c:Array.isArray(c)?"array":{}.toString.call(c).slice(8,-1).toLowerCase())||/\d/.test(t)||(r=t,t=void 0),(t=t||new Date)instanceof Date||(t=new Date(t)),isNaN(t))throw TypeError("Invalid date");var c,u=(r=String(s.masks[r]||r||s.masks.default)).slice(0,4);"UTC:"!==u&&"GMT:"!==u||(r=r.slice(4),a=!0,"GMT:"===u&&(h=!0));var l=a?"getUTC":"get",p=t[l+"Date"](),d=t[l+"Day"](),f=t[l+"Month"](),m=t[l+"FullYear"](),g=t[l+"Hours"](),y=t[l+"Minutes"](),b=t[l+"Seconds"](),v=t[l+"Milliseconds"](),w=a?0:t.getTimezoneOffset(),x=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var i=new Date(e.getFullYear(),0,4);i.setDate(i.getDate()-(i.getDay()+6)%7+3);var n=e.getTimezoneOffset()-i.getTimezoneOffset();return e.setHours(e.getHours()-n),1+Math.floor((e-i)/6048e5)}(t),R=function(t){var e=t.getDay();return 0===e&&(e=7),e}(t),T={d:p,dd:o(p),ddd:s.i18n.dayNames[d],dddd:s.i18n.dayNames[d+7],m:f+1,mm:o(f+1),mmm:s.i18n.monthNames[f],mmmm:s.i18n.monthNames[f+12],yy:String(m).slice(2),yyyy:m,h:g%12||12,hh:o(g%12||12),H:g,HH:o(g),M:y,MM:o(y),s:b,ss:o(b),l:o(v,3),L:o(Math.round(v/10)),t:g<12?s.i18n.timeNames[0]:s.i18n.timeNames[1],tt:g<12?s.i18n.timeNames[2]:s.i18n.timeNames[3],T:g<12?s.i18n.timeNames[4]:s.i18n.timeNames[5],TT:g<12?s.i18n.timeNames[6]:s.i18n.timeNames[7],Z:h?"GMT":a?"UTC":(String(t).match(i)||[""]).pop().replace(n,""),o:(w>0?"-":"+")+o(100*Math.floor(Math.abs(w)/60)+Math.abs(w)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:x,N:R};return r.replace(e,function(t){return t in T?T[t]:t.slice(1,t.length-1)})});function o(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}s.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},s.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},t.exports=s}()}),v="",w=function(t,e){if("string"!=typeof t)throw new TypeError("expected a string");if(1===e)return t;if(2===e)return t+t;var i=t.length*e;if(f!==t||void 0===f)f=t,v="";else if(v.length>=i)return v.substr(0,i);for(;i>v.length&&e>1;)1&e&&(v+=t),e>>=1,t+=t;return v=(v+=t).substr(0,i)};var x,R=function(){},T={extension:"",prefix:"",suffix:""},_=["image/png","image/jpeg","image/webp"];function k(t,e){return void 0===e&&(e={}),new Promise(function(i,n){e=s({},T,e);var o=E(Object.assign({},e,{extension:"",frame:void 0})),r=t?"streamStart":"streamEnd",a=u();return a&&a.output&&"function"==typeof a[r]?a[r](s({},e,{filename:o})).then(function(t){return i(t)}):i({filename:o,client:!1})})}function C(t,e){return void 0===e&&(e={}),function(t){return new Promise(function(e){var i=t.indexOf(",");if(-1!==i){for(var n=t.slice(i+1),s=window.atob(n),o=t.slice(0,i),r=/data:([^;]+)/.exec(o),a=(r?r[1]:"")||void 0,h=new ArrayBuffer(s.length),c=new Uint8Array(h),u=0;u<s.length;u++)c[u]=s.charCodeAt(u);e(new window.Blob([h],{type:a}))}else e(new window.Blob)})}(t).then(function(t){return M(t,e)})}function M(t,e){return void 0===e&&(e={}),new Promise(function(i){var n=(e=s({},T,e)).filename,o=u();if(o&&"function"==typeof o.saveBlob&&o.output)return o.saveBlob(t,s({},e,{filename:n})).then(function(t){return i(t)});x||((x=document.createElement("a")).style.visibility="hidden",x.target="_blank"),x.download=n,x.href=window.URL.createObjectURL(t),document.body.appendChild(x),x.onclick=function(){x.onclick=R,setTimeout(function(){window.URL.revokeObjectURL(t),x.parentElement&&x.parentElement.removeChild(x),x.removeAttribute("href"),i({filename:n,client:!1})})},x.click()})}function E(t){if(void 0===t&&(t={}),"function"==typeof(t=s({},t)).file)return t.file(t);if(t.file)return t.file;var e,i,n,o,r=null,a="";("string"==typeof t.extension&&(a=t.extension),"number"==typeof t.frame)&&(e="number"==typeof t.totalFrames?t.totalFrames:Math.max(1e4,t.frame),i=String(t.frame),n=String(e).length,o="0",i=i.toString(),r=void 0===n?i:(o=0===o?"0":o?o.toString():" ",w(o,n-i.length)+i));var h=isFinite(t.totalLayers)&&isFinite(t.layer)&&t.totalLayers>1?""+t.layer:"";return null!=r?[h,r].filter(Boolean).join("-")+a:[t.prefix,t.name||t.timeStamp,h,t.hash,t.suffix].filter(Boolean).join("-")+a}var P={dimension:"dimensions",animated:"animate",animating:"animate",unit:"units",P5:"p5",pixellated:"pixelated",looping:"loop",pixelPerInch:"pixels"},S=["dimensions","units","pixelsPerInch","orientation","scaleToFit","scaleToView","bleed","pixelRatio","exportPixelRatio","maxPixelRatio","scaleContext","resizeCanvas","styleCanvas","canvas","context","attributes","parent","file","name","prefix","suffix","animate","playing","loop","duration","totalFrames","fps","playbackRate","timeScale","frame","time","flush","pixelated","hotkeys","p5","id","scaleToFitPadding","data","params","encoding","encodingQuality"],F=function(t){Object.keys(t).forEach(function(t){t in P?console.warn('[canvas-sketch] Could not recognize the setting "'+t+'", did you mean "'+P[t]+'"?'):S.includes(t)||console.warn('[canvas-sketch] Could not recognize the setting "'+t+'"')})};var B=[["postcard",101.6,152.4],["poster-small",280,430],["poster",460,610],["poster-large",610,910],["business-card",50.8,88.9],["2r",64,89],["3r",89,127],["4r",102,152],["5r",127,178],["6r",152,203],["8r",203,254],["10r",254,305],["11r",279,356],["12r",305,381],["a0",841,1189],["a1",594,841],["a2",420,594],["a3",297,420],["a4",210,297],["a5",148,210],["a6",105,148],["a7",74,105],["a8",52,74],["a9",37,52],["a10",26,37],["2a0",1189,1682],["4a0",1682,2378],["b0",1e3,1414],["b1",707,1e3],["b1+",720,1020],["b2",500,707],["b2+",520,720],["b3",353,500],["b4",250,353],["b5",176,250],["b6",125,176],["b7",88,125],["b8",62,88],["b9",44,62],["b10",31,44],["b11",22,32],["b12",16,22],["c0",917,1297],["c1",648,917],["c2",458,648],["c3",324,458],["c4",229,324],["c5",162,229],["c6",114,162],["c7",81,114],["c8",57,81],["c9",40,57],["c10",28,40],["c11",22,32],["c12",16,22],["half-letter",5.5,8.5,"in"],["letter",8.5,11,"in"],["legal",8.5,14,"in"],["junior-legal",5,8,"in"],["ledger",11,17,"in"],["tabloid",11,17,"in"],["ansi-a",8.5,11,"in"],["ansi-b",11,17,"in"],["ansi-c",17,22,"in"],["ansi-d",22,34,"in"],["ansi-e",34,44,"in"],["arch-a",9,12,"in"],["arch-b",12,18,"in"],["arch-c",18,24,"in"],["arch-d",24,36,"in"],["arch-e",36,48,"in"],["arch-e1",30,42,"in"],["arch-e2",26,38,"in"],["arch-e3",27,39,"in"]].reduce(function(t,e){var i={units:e[3]||"mm",dimensions:[e[1],e[2]]};return t[e[0]]=i,t[e[0].replace(/-/g," ")]=i,t},{}),D=["mm","cm","m","pc","pt","in","ft","px"],A={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const j={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};var O=function(t,e,i,n){if("number"!=typeof t||!isFinite(t))throw new Error("Value must be a finite number");if(!e||!i)throw new Error("Must specify from and to units");var s=function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]}((n=n||{}).pixelsPerInch,96),o=n.precision,r=!1!==n.roundPixel;if(e=e.toLowerCase(),i=i.toLowerCase(),-1===D.indexOf(e))throw new Error('Invalid from unit "'+e+'", must be one of: '+D.join(", "));if(-1===D.indexOf(i))throw new Error('Invalid from unit "'+i+'", must be one of: '+D.join(", "));if(e===i)return t;var a=1,h=1,c=!1;"px"===e&&(h=1/s,e="in"),"px"===i&&(c=!0,a=s,i="in");var u=A[e],l=A[i],p=t*u.factor*h;u.system!==l.system&&(p*=j[u.system].ratio);var d=p/l.factor*a;return c&&r?d=Math.round(d):"number"==typeof o&&isFinite(o)&&(d=function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}(d,o)),d};function I(t,e,i,n){return void 0===e&&(e="px"),void 0===i&&(i="px"),void 0===n&&(n=72),O(t,e,i,{pixelsPerInch:n,precision:4,roundPixel:!0})}function L(t,e){var i,n,s,o,r,a,h=p(),c=e.dimensions,u=function(t){return!(!t.dimensions||"string"!=typeof t.dimensions&&!(Array.isArray(t.dimensions)&&t.dimensions.length>=2))}(e),d=t.exporting,f=!!u&&!1!==e.scaleToFit,m=!(!d&&u)||e.scaleToView;h||(f=m=!1);var g,y,b=e.units,v="number"==typeof e.pixelsPerInch&&isFinite(e.pixelsPerInch)?e.pixelsPerInch:72,w=l(e.bleed,0),x=h?window.devicePixelRatio:1,R=m?x:1;"number"==typeof e.pixelRatio&&isFinite(e.pixelRatio)?y=l(e.exportPixelRatio,g=e.pixelRatio):u?(g=R,y=l(e.exportPixelRatio,1)):y=l(e.exportPixelRatio,g=x),"number"==typeof e.maxPixelRatio&&isFinite(e.maxPixelRatio)&&(g=Math.min(e.maxPixelRatio,g)),d&&(g=y);var T,_,k=function(t,e){if(!p())return[300,150];var i=e.parent||window;if(i===window||i===document||i===document.body)return[window.innerWidth,window.innerHeight];var n=i.getBoundingClientRect();return[n.width,n.height]}(0,e),C=k[0],M=k[1];if(u){var E=function(t,e,i){if(void 0===e&&(e="px"),void 0===i&&(i=72),"string"==typeof t){var n=t.toLowerCase();if(!(n in B))throw new Error('The dimension preset "'+t+'" is not supported or could not be found; try using a4, a3, postcard, letter, etc.');var s=B[n];return s.dimensions.map(function(t){return I(t,s.units,e,i)})}return t}(c,b,v),P=Math.max(E[0],E[1]),S=Math.min(E[0],E[1]);if(e.orientation){var F="landscape"===e.orientation;i=F?P:S,n=F?S:P}else i=E[0],n=E[1];T=i,_=n,i+=2*w,n+=2*w}else T=i=C,_=n=M;var D=i,A=n;if(u&&b&&(D=I(i,b,"px",v),A=I(n,b,"px",v)),s=Math.round(D),o=Math.round(A),f&&!d&&u){var j=i/n,O=C/M,L=l(e.scaleToFitPadding,40),N=Math.round(C-2*L),H=Math.round(M-2*L);(s>N||o>H)&&(O>j?(o=H,s=Math.round(o*j)):(s=N,o=Math.round(s/j)))}return{bleed:w,pixelRatio:g,width:i,height:n,dimensions:[i,n],units:b||"px",scaleX:(r=m?Math.round(g*s):Math.round(g*D))/i,scaleY:(a=m?Math.round(g*o):Math.round(g*A))/n,pixelsPerInch:v,viewportWidth:m?Math.round(s):Math.round(D),viewportHeight:m?Math.round(o):Math.round(A),canvasWidth:r,canvasHeight:a,trimWidth:T,trimHeight:_,styleWidth:s,styleHeight:o}}O.units=D;var N=function(t,e){if("string"!=typeof t)throw new TypeError("must specify type string");if(e=e||{},"undefined"==typeof document&&!e.canvas)return null;var i=e.canvas||document.createElement("canvas");"number"==typeof e.width&&(i.width=e.width);"number"==typeof e.height&&(i.height=e.height);var n,s=e;try{var o=[t];0===t.indexOf("webgl")&&o.push("experimental-"+t);for(var r=0;r<o.length;r++)if(n=i.getContext(o[r],s))return n}catch(t){n=null}return n||null};function H(t){var e,i;void 0===t&&(t={});var n=!1;if(!1!==t.canvas){if(!(e=t.context)||"string"==typeof e){var o=t.canvas;o||(o=function(){if(!p())throw new Error("It appears you are runing from Node.js or a non-browser environment. Try passing in an existing { canvas } interface instead.");return document.createElement("canvas")}(),n=!0);var r=e||"2d";if("function"!=typeof o.getContext)throw new Error("The specified { canvas } element does not have a getContext() function, maybe it is not a <canvas> tag?");if(!(e=N(r,s({},t.attributes,{canvas:o}))))throw new Error("Failed at canvas.getContext('"+r+"') - the browser may not support this context, or a different context may already be in use with this canvas.")}if(i=e.canvas,t.canvas&&i!==t.canvas)throw new Error("The { canvas } and { context } settings must point to the same underlying canvas element");t.pixelated&&(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,i.style["image-rendering"]="pixelated")}return{canvas:i,context:e,ownsCanvas:n}}var z=function(){var t=this;this._settings={},this._props={},this._sketch=void 0,this._raf=null,this._recordTimeout=null,this._lastRedrawResult=void 0,this._isP5Resizing=!1,this._keyboardShortcuts=function(t){void 0===t&&(t={});var e=function(e){if(t.enabled()){var i=u();83!==e.keyCode||e.altKey||!e.metaKey&&!e.ctrlKey?32===e.keyCode?t.togglePlay(e):i&&!e.altKey&&75===e.keyCode&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t.commit(e)):(e.preventDefault(),t.save(e))}};return{attach:function(){window.addEventListener("keydown",e)},detach:function(){window.removeEventListener("keydown",e)}}}({enabled:function(){return!1!==t.settings.hotkeys},save:function(e){e.shiftKey?t.props.recording?(t.endRecord(),t.run()):t.record():t.props.recording||t.exportFrame()},togglePlay:function(){t.props.playing?t.pause():t.play()},commit:function(e){t.exportFrame({commit:!0})}}),this._animateHandler=function(){return t.animate()},this._resizeHandler=function(){t.resize()&&t.render()}},U={sketch:{configurable:!0},settings:{configurable:!0},props:{configurable:!0}};U.sketch.get=function(){return this._sketch},U.settings.get=function(){return this._settings},U.props.get=function(){return this._props},z.prototype._computePlayhead=function(t,e){return"number"==typeof e&&isFinite(e)?t/e:0},z.prototype._computeFrame=function(t,e,i,n){return isFinite(i)&&i>1?Math.floor(t*(i-1)):Math.floor(n*e)},z.prototype._computeCurrentFrame=function(){return this._computeFrame(this.props.playhead,this.props.time,this.props.totalFrames,this.props.fps)},z.prototype._getSizeProps=function(){var t=this.props;return{width:t.width,height:t.height,pixelRatio:t.pixelRatio,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,viewportWidth:t.viewportWidth,viewportHeight:t.viewportHeight}},z.prototype.run=function(){if(!this.sketch)throw new Error("should wait until sketch is loaded before trying to play()");return!1!==this.settings.playing&&this.play(),"function"==typeof this.sketch.dispose&&console.warn("In canvas-sketch@0.0.23 the dispose() event has been renamed to unload()"),this.props.started||(this._signalBegin(),this.props.started=!0),this.tick(),this.render(),this},z.prototype._cancelTimeouts=function(){null!=this._raf&&"undefined"!=typeof window&&"function"==typeof window.cancelAnimationFrame&&(window.cancelAnimationFrame(this._raf),this._raf=null),null!=this._recordTimeout&&(clearTimeout(this._recordTimeout),this._recordTimeout=null)},z.prototype.play=function(){var t=this.settings.animate;"animation"in this.settings&&(t=!0,console.warn("[canvas-sketch] { animation } has been renamed to { animate }")),t&&(p()?this.props.playing||(this.props.started||(this._signalBegin(),this.props.started=!0),this.props.playing=!0,this._cancelTimeouts(),this._lastTime=a(),this._raf=window.requestAnimationFrame(this._animateHandler)):console.error("[canvas-sketch] WARN: Using { animate } in Node.js is not yet supported"))},z.prototype.pause=function(){this.props.recording&&this.endRecord(),this.props.playing=!1,this._cancelTimeouts()},z.prototype.togglePlay=function(){this.props.playing?this.pause():this.play()},z.prototype.stop=function(){this.pause(),this.props.frame=0,this.props.playhead=0,this.props.time=0,this.props.deltaTime=0,this.props.started=!1,this.render()},z.prototype.record=function(){var t=this;if(!this.props.recording)if(p()){this.stop(),this.props.playing=!0,this.props.recording=!0;var e=this._createExportOptions({sequence:!0}),i=1/this.props.fps;this._cancelTimeouts();var n,s=function(){return t.props.recording?(t.props.deltaTime=i,t.tick(),t.exportFrame(e).then(function(){t.props.recording&&(t.props.deltaTime=0,t.props.frame++,t.props.frame<t.props.totalFrames?(t.props.time+=i,t.props.playhead=t._computePlayhead(t.props.time,t.props.duration),t._recordTimeout=setTimeout(s,0)):(console.log("Finished recording"),t._signalEnd(),t.endRecord(),t.stop(),t.run()))})):Promise.resolve()};this.props.started||(this._signalBegin(),this.props.started=!0),this.sketch&&"function"==typeof this.sketch.beginRecord&&this._wrapContextScale(function(e){return t.sketch.beginRecord(e)}),(n=e,void 0===n&&(n={}),k(!0,n)).catch(function(t){console.error(t)}).then(function(e){t._raf=window.requestAnimationFrame(s)})}else console.error("[canvas-sketch] WARN: Recording from Node.js is not yet supported")},z.prototype._signalBegin=function(){var t=this;this.sketch&&"function"==typeof this.sketch.begin&&this._wrapContextScale(function(e){return t.sketch.begin(e)})},z.prototype._signalEnd=function(){var t=this;this.sketch&&"function"==typeof this.sketch.end&&this._wrapContextScale(function(e){return t.sketch.end(e)})},z.prototype.endRecord=function(){var t,e=this,i=this.props.recording;return this._cancelTimeouts(),this.props.recording=!1,this.props.deltaTime=0,this.props.playing=!1,(void 0===t&&(t={}),k(!1,t)).catch(function(t){console.error(t)}).then(function(){i&&e.sketch&&"function"==typeof e.sketch.endRecord&&e._wrapContextScale(function(t){return e.sketch.endRecord(t)})})},z.prototype._createExportOptions=function(t){return void 0===t&&(t={}),{sequence:t.sequence,save:t.save,fps:this.props.fps,frame:t.sequence?this.props.frame:void 0,file:this.settings.file,name:this.settings.name,prefix:this.settings.prefix,suffix:this.settings.suffix,encoding:this.settings.encoding,encodingQuality:this.settings.encodingQuality,timeStamp:t.timeStamp||b(new Date,"yyyy.mm.dd-HH.MM.ss"),totalFrames:isFinite(this.props.totalFrames)?Math.max(0,this.props.totalFrames):1e3}},z.prototype.exportFrame=function(t){var e=this;if(void 0===t&&(t={}),!this.sketch)return Promise.all([]);"function"==typeof this.sketch.preExport&&this.sketch.preExport();var i=this._createExportOptions(t),n=u(),o=Promise.resolve();if(n&&t.commit&&"function"==typeof n.commit){var r=s({},i),a=n.commit(r);o=h(a)?a:Promise.resolve(a)}return o.then(function(t){return e._doExportFrame(s({},i,{hash:t||""}))}).then(function(t){return 1===t.length?t[0]:t})},z.prototype._doExportFrame=function(t){var e=this;void 0===t&&(t={}),this._props.exporting=!0,this.resize();var i=this.render();return void 0===i&&(i=[this.props.canvas]),i=(i=[].concat(i).filter(Boolean)).map(function(e){var i,n="object"==typeof e&&e&&("data"in e||"dataURL"in e),o=n?e.data:e,r=n?s({},e,{data:o}):{data:o};if(c(i=o)&&/canvas/i.test(i.nodeName)&&"function"==typeof i.getContext){var a=function(t,e){void 0===e&&(e={});var i=e.encoding||"image/png";if(!_.includes(i))throw new Error("Invalid canvas encoding "+i);var n=(i.split("/")[1]||"").replace(/jpeg/i,"jpg");return n&&(n=("."+n).toLowerCase()),{extension:n,type:i,dataURL:t.toDataURL(i,e.encodingQuality)}}(o,{encoding:r.encoding||t.encoding,encodingQuality:l(r.encodingQuality,t.encodingQuality,.95)});return Object.assign(r,{dataURL:a.dataURL,extension:a.extension,type:a.type})}return r}),this._props.exporting=!1,this.resize(),this.render(),Promise.all(i.map(function(e,i,n){var o=s({extension:"",prefix:"",suffix:""},t,e,{layer:i,totalLayers:n.length}),r=!1!==t.save&&e.save;for(var a in o.save=!1!==r,o.filename=E(o),delete o.encoding,delete o.encodingQuality,o)void 0===o[a]&&delete o[a];var h=Promise.resolve({});if(o.save){var c=o.data;if(o.dataURL)h=C(o.dataURL,o);else h=function(t,e){void 0===e&&(e={});var i=Array.isArray(t)?t:[t];return M(new window.Blob(i,{type:e.type||""}),e)}(c,o)}return h.then(function(t){return Object.assign({},o,t)})})).then(function(i){var n=i.filter(function(t){return t.save});if(n.length>0){var s,o=n.find(function(t){return t.outputName}),r=n.some(function(t){return t.client}),a=n.some(function(t){return t.stream});s=n.length>1?n.length:o?o.outputName+"/"+n[0].filename:""+n[0].filename;var h="";if(t.sequence)h=isFinite(e.props.totalFrames)?" (frame "+(t.frame+1)+" / "+e.props.totalFrames+")":" (frame "+t.frame+")";else n.length>1&&(h=" files");console.log("%c["+(r?"canvas-sketch-cli":"canvas-sketch")+"]%c "+(a?"Streaming into":"Exported")+" %c"+s+"%c"+h,"color: #8e8e8e;","color: initial;","font-weight: bold;","font-weight: initial;")}return"function"==typeof e.sketch.postExport&&e.sketch.postExport(),i})},z.prototype._wrapContextScale=function(t){this._preRender(),t(this.props),this._postRender()},z.prototype._preRender=function(){var t=this.props;d(t.context)&&!t.p5?(t.context.save(),!1!==this.settings.scaleContext&&t.context.scale(t.scaleX,t.scaleY)):t.p5&&t.p5.scale(t.scaleX/t.pixelRatio,t.scaleY/t.pixelRatio)},z.prototype._postRender=function(){var t=this.props;d(t.context)&&!t.p5&&t.context.restore(),t.gl&&!1!==this.settings.flush&&!t.p5&&t.gl.flush()},z.prototype.tick=function(){this.sketch&&"function"==typeof this.sketch.tick&&(this._preRender(),this.sketch.tick(this.props),this._postRender())},z.prototype.render=function(){return this.props.p5?(this._lastRedrawResult=void 0,this.props.p5.redraw(),this._lastRedrawResult):this.submitDrawCall()},z.prototype.submitDrawCall=function(){if(this.sketch){var t,e=this.props;return this._preRender(),"function"==typeof this.sketch?t=this.sketch(e):"function"==typeof this.sketch.render&&(t=this.sketch.render(e)),this._postRender(),t}},z.prototype.update=function(t){var e=this;void 0===t&&(t={});var i=["animate"];Object.keys(t).forEach(function(t){if(i.indexOf(t)>=0)throw new Error("Sorry, the { "+t+" } option is not yet supported with update().")});var n=this._settings.canvas,s=this._settings.context;for(var o in t){var r=t[o];void 0!==r&&(e._settings[o]=r)}var a=Object.assign({},this._settings,t);if("time"in t&&"frame"in t)throw new Error("You should specify { time } or { frame } but not both");if("time"in t?delete a.frame:"frame"in t&&delete a.time,"duration"in t&&"totalFrames"in t)throw new Error("You should specify { duration } or { totalFrames } but not both");"duration"in t?delete a.totalFrames:"totalFrames"in t&&delete a.duration,"data"in t&&(this._props.data=t.data);var h=this.getTimeProps(a);if(Object.assign(this._props,h),n!==this._settings.canvas||s!==this._settings.context){var c=H(this._settings),u=c.context;this.props.canvas=c.canvas,this.props.context=u,this._setupGLKey(),this._appendCanvasIfNeeded()}return t.p5&&"function"!=typeof t.p5&&(this.props.p5=t.p5,this.props.p5.draw=function(){e._isP5Resizing||(e._lastRedrawResult=e.submitDrawCall())}),"playing"in t&&(t.playing?this.play():this.pause()),F(this._settings),this.resize(),this.render(),this.props},z.prototype.resize=function(){var t=this._getSizeProps(),e=this.settings,i=this.props,n=L(i,e);Object.assign(this._props,n);var s=this.props,o=s.pixelRatio,r=s.canvasWidth,a=s.canvasHeight,h=s.styleWidth,c=s.styleHeight,u=this.props.canvas;u&&!1!==e.resizeCanvas&&(i.p5?u.width===r&&u.height===a||(this._isP5Resizing=!0,i.p5.pixelDensity(o),i.p5.resizeCanvas(r/o,a/o,!1),this._isP5Resizing=!1):(u.width!==r&&(u.width=r),u.height!==a&&(u.height=a)),p()&&!1!==e.styleCanvas&&(u.style.width=h+"px",u.style.height=c+"px"));var l=this._getSizeProps(),d=!y(t,l);return d&&this._sizeChanged(),d},z.prototype._sizeChanged=function(){this.sketch&&"function"==typeof this.sketch.resize&&this.sketch.resize(this.props)},z.prototype.animate=function(){if(this.props.playing)if(p()){this._raf=window.requestAnimationFrame(this._animateHandler);var t=a(),e=1e3/this.props.fps,i=t-this._lastTime,n=this.props.duration,s="number"==typeof n&&isFinite(n),o=!0,r=this.settings.playbackRate;"fixed"===r?i=e:"throttle"===r?i>e?this._lastTime=t-=i%e:o=!1:this._lastTime=t;var h=i/1e3,c=this.props.time+h*this.props.timeScale;c<0&&s&&(c=n+c);var u=!1,l=!1;if(s&&c>=n&&(!1!==this.settings.loop?(o=!0,c%=n,l=!0):(o=!1,c=n,u=!0),this._signalEnd()),o){this.props.deltaTime=h,this.props.time=c,this.props.playhead=this._computePlayhead(c,n);var d=this.props.frame;this.props.frame=this._computeCurrentFrame(),l&&this._signalBegin(),d!==this.props.frame&&this.tick(),this.render(),this.props.deltaTime=0}u&&this.pause()}else console.error("[canvas-sketch] WARN: Animation in Node.js is not yet supported")},z.prototype.dispatch=function(t){if("function"!=typeof t)throw new Error("must pass function into dispatch()");t(this.props),this.render()},z.prototype.mount=function(){this._appendCanvasIfNeeded()},z.prototype.unmount=function(){p()&&(window.removeEventListener("resize",this._resizeHandler),this._keyboardShortcuts.detach()),this.props.canvas.parentElement&&this.props.canvas.parentElement.removeChild(this.props.canvas)},z.prototype._appendCanvasIfNeeded=function(){p()&&(!1!==this.settings.parent&&this.props.canvas&&!this.props.canvas.parentElement&&(this.settings.parent||document.body).appendChild(this.props.canvas))},z.prototype._setupGLKey=function(){var t;this.props.context&&((t=this.props.context)&&"function"==typeof t.clear&&"function"==typeof t.clearColor&&"function"==typeof t.bufferData?this._props.gl=this.props.context:delete this._props.gl)},z.prototype.getTimeProps=function(t){void 0===t&&(t={});var e=t.duration,i=t.totalFrames,n=l(t.timeScale,1),s=l(t.fps,24),o="number"==typeof e&&isFinite(e),r="number"==typeof i&&isFinite(i),a=o?Math.floor(s*e):void 0,h=r?i/s:void 0;if(o&&r&&a!==i)throw new Error("You should specify either duration or totalFrames, but not both. Or, they must match exactly.");void 0===t.dimensions&&void 0!==t.units&&console.warn("You've specified a { units } setting but no { dimension }, so the units will be ignored."),i=l(i,a,Infinity),e=l(e,h,Infinity);var c=t.time,u=t.frame,p="number"==typeof c&&isFinite(c),d="number"==typeof u&&isFinite(u),f=0,m=0,g=0;if(p&&d)throw new Error("You should specify either start frame or time, but not both.");return p?(g=this._computePlayhead(f=c,e),m=this._computeFrame(g,f,i,s)):d&&(g=this._computePlayhead(f=(m=u)/s,e)),{playhead:g,time:f,frame:m,duration:e,totalFrames:i,fps:s,timeScale:n}},z.prototype.setup=function(t){var e=this;if(void 0===t&&(t={}),this.sketch)throw new Error("Multiple setup() calls not yet supported.");this._settings=Object.assign({},t,this._settings),F(this._settings);var i=H(this._settings),n=i.context,s=i.canvas,o=this.getTimeProps(this._settings);this._props=Object.assign({},o,{canvas:s,context:n,deltaTime:0,started:!1,exporting:!1,playing:!1,recording:!1,settings:this.settings,data:this.settings.data,render:function(){return e.render()},togglePlay:function(){return e.togglePlay()},dispatch:function(t){return e.dispatch(t)},tick:function(){return e.tick()},resize:function(){return e.resize()},update:function(t){return e.update(t)},exportFrame:function(t){return e.exportFrame(t)},record:function(){return e.record()},play:function(){return e.play()},pause:function(){return e.pause()},stop:function(){return e.stop()}}),this._setupGLKey(),this.resize()},z.prototype.loadAndRun=function(t,e){var i=this;return this.load(t,e).then(function(){return i.run(),i})},z.prototype.unload=function(){var t=this;this.pause(),this.sketch&&("function"==typeof this.sketch.unload&&this._wrapContextScale(function(e){return t.sketch.unload(e)}),this._sketch=null)},z.prototype.destroy=function(){this.unload(),this.unmount()},z.prototype.load=function(t,e){var i=this;if("function"!=typeof t)throw new Error("The function must take in a function as the first parameter. Example:\n  canvasSketcher(() => { ... }, settings)");this.sketch&&this.unload(),void 0!==e&&this.update(e),this._preRender();var n=Promise.resolve();if(this.settings.p5){if(!p())throw new Error("[canvas-sketch] ERROR: Using p5.js in Node.js is not supported");n=new Promise(function(t){var e,n=i.settings.p5;n.p5&&(e=n.preload,n=n.p5);var s=function(n){e&&(n.preload=function(){return e(n)}),n.setup=function(){var e=i.props,s="webgl"===i.settings.context,o=s?n.WEBGL:n.P2D;n.noLoop(),n.pixelDensity(e.pixelRatio),n.createCanvas(e.viewportWidth,e.viewportHeight,o),s&&i.settings.attributes&&n.setAttributes(i.settings.attributes),i.update({p5:n,canvas:n.canvas,context:n._renderer.drawingContext}),t()}};if("function"==typeof n)new n(s);else{if("function"!=typeof window.createCanvas)throw new Error("{ p5 } setting is passed but can't find p5.js in global (window) scope. Maybe you did not create it globally?\nnew p5(); // <-- attaches to global scope");s(window)}})}return n.then(function(){var e=t(i.props);return h(e)||(e=Promise.resolve(e)),e}).then(function(t){return t||(t={}),i._sketch=t,p()&&(i._keyboardShortcuts.attach(),window.addEventListener("resize",i._resizeHandler)),i._postRender(),i._sizeChanged(),i}).catch(function(t){throw console.warn("Could not start sketch, the async loading function rejected with an error:\n    Error: "+t.message),t})},Object.defineProperties(z.prototype,U);var W="hot-id-cache",Y=[];function $(t,e){if(void 0===e&&(e={}),e.p5){if(e.canvas||e.context&&"string"!=typeof e.context)throw new Error('In { p5 } mode, you can\'t pass your own canvas or context, unless the context is a "webgl" or "2d" string');e=Object.assign({},e,{canvas:!1,context:"string"==typeof e.context&&e.context})}var i,n,s=(i=u())&&i.hot;s&&(n=l(e.id,"$__DEFAULT_CANVAS_SKETCH_ID__$"));var o=s&&"string"==typeof n;o&&Y.includes(n)&&(console.warn("Warning: You have multiple calls to canvasSketch() in --hot mode. You must pass unique { id } strings in settings to enable hot reload across multiple sketches. ",n),o=!1);var r=Promise.resolve();if(o){Y.push(n);var a=function(t){var e=u();if(e)return e[W]=e[W]||{},e[W][t]}(n);if(a){var h=function(){var t,i=(t=a.manager,e.animate?{time:t.props.time}:void 0);return a.manager.destroy(),i};r=a.load.then(h).catch(h)}}return r.then(function(i){var s,r=new z;return t?(e=Object.assign({},e,i),r.setup(e),r.mount(),s=r.loadAndRun(t)):s=Promise.resolve(r),o&&function(t,e){var i=u();i&&(i[W]=i[W]||{},i[W][t]=e)}(n,{load:s,manager:r}),s})}return $.canvasSketch=$,$.PaperSizes=B,$})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(t,e,i){const{createContainer:n}=t("../containers/container-system"),{reasonsForLeaving:s,emotionsDuringImmigration:o}=t("../data/survey-data"),{ReasonBubble:r,EmotionBubble:a,BubblePhysics:h}=t("../physics/bubble");e.exports=class{constructor(t,e){this.width=t,this.height=e,this.container=n("popcorn-maker",t,e),this.reasonBubbles=[],this.emotionBubbles=[],this.nextBubbleTime=1,this.bubbleIndex=0,this.maxIterations=2,this.reasonsComplete=!1,this.emotionsTriggered=!1,this.emotionBubbleIndex=0,this.nextEmotionTime=0,console.log("Phase 1 initialized with cleaned bubble system"),this.setupMouseListener()}setupMouseListener(){const t=()=>{this.reasonsComplete&&!this.emotionsTriggered&&(this.emotionsTriggered=!0,this.nextEmotionTime=0,console.log("Emotions triggered by mouse click!"))};document.addEventListener("click",t),this.cleanup=()=>document.removeEventListener("click",t)}createReasonBubble(t){return new r(t,this.container)}createEmotionBubble(t){return new a(t,this.container)}purgeReasonBubbles(){console.log("Purging reason bubbles with pop animation..."),this.reasonBubbles=h.purgeBubbles(this.reasonBubbles),this.bubbleIndex=0,this.reasonsComplete=!1}purgeEmotionBubbles(){console.log("Purging emotion bubbles with pop animation..."),this.emotionBubbles=h.purgeBubbles(this.emotionBubbles),this.emotionBubbleIndex=0,this.emotionsTriggered=!1}render({context:t,time:e,width:i,height:n}){const r=1/60;if(!this.reasonsComplete&&e>this.nextBubbleTime){if(this.reasonBubbles.length<s.length*this.maxIterations){const t=this.bubbleIndex%s.length;this.reasonBubbles.push(this.createReasonBubble(s[t])),this.bubbleIndex++,this.nextBubbleTime=e+.5+.3*Math.random(),console.log(`Added reason bubble: ${s[t].word}`)}else this.reasonsComplete=!0,console.log("All reason bubbles complete! Click to trigger emotions.")}if(this.emotionsTriggered&&e>this.nextEmotionTime&&this.emotionBubbleIndex<o.length){const t=o[this.emotionBubbleIndex];this.emotionBubbles.push(this.createEmotionBubble(t)),this.emotionBubbleIndex++,this.nextEmotionTime=e+.8+.4*Math.random(),console.log(`Added emotion bubble: ${t.word}`)}this.reasonBubbles.forEach(t=>t.update(r)),this.emotionBubbles.forEach(t=>t.update(r)),this.reasonBubbles=this.reasonBubbles.filter(t=>!t.isDestroyed()),this.emotionBubbles=this.emotionBubbles.filter(t=>!t.isDestroyed());const a=[...this.reasonBubbles,...this.emotionBubbles];h.checkCollisions(a),t.fillStyle="#1a1a1a",t.fillRect(0,0,i,n),this.container.render2D(t),this.reasonBubbles.forEach(i=>i.render(t,e)),this.emotionBubbles.forEach(i=>i.render(t,e)),this.renderUI(t,i,n)}renderUI(t,e,i){t.fillStyle="rgba(255, 255, 255, 0.8)",t.font="16px Arial",t.textAlign="left",t.fillText(`Reason Bubbles: ${this.reasonBubbles.length}`,20,30),t.fillText(`Emotion Bubbles: ${this.emotionBubbles.length}`,20,50),t.fillText(`Canvas: ${e} x ${i}`,20,70),t.fillStyle="rgba(255, 255, 255, 0.9)",t.font="bold 28px Arial",t.textAlign="center",t.fillText("Part 1: The Decision - Reasons for Leaving & Emotions",e/2,40),this.reasonsComplete&&!this.emotionsTriggered?(t.fillStyle="#FFD700",t.font="bold 32px Arial",t.textAlign="center",t.fillText("ðŸ–±ï¸ CLICK TO TRIGGER EMOTIONS",e/2,i-60)):this.emotionsTriggered&&(t.fillStyle="#90EE90",t.font="bold 24px Arial",t.textAlign="center",t.fillText("âœ¨ Emotions Activated!",e/2,i-60)),this.reasonBubbles.length>0&&(t.fillStyle="rgba(255, 0, 0, 0.7)",t.font="14px Arial",t.textAlign="right",t.fillText("Press R to purge reasons",e-20,i-100)),this.emotionBubbles.length>0&&(t.fillStyle="rgba(0, 255, 0, 0.7)",t.font="14px Arial",t.textAlign="right",t.fillText("Press E to purge emotions",e-20,i-80))}handleKeyPress(t){switch(t.toLowerCase()){case"r":this.purgeReasonBubbles();break;case"e":this.purgeEmotionBubbles()}}isComplete(t){return!1}destroy(){this.cleanup&&this.cleanup()}}},{"../containers/container-system":2,"../data/survey-data":3,"../physics/bubble":7}],7:[function(t,e,i){const{reasonsForLeaving:n,emotionsDuringImmigration:s}=t("../data/survey-data");class o{constructor(t,e){this.word=t.word,this.responses=t.responses,this.container=e,this.targetRadius=this.calculateRadius(t.responses),this.currentRadius=0,this.x=e.getRandomSpawnX(this.targetRadius),this.y=e.getSpawnY(this.targetRadius),this.velocityX=4*(Math.random()-.5),this.velocityY=-8-6*Math.random(),this.gravity=.4,this.bounce=.6+.2*Math.random(),this.friction=.99,this.mass=this.targetRadius/20,this.age=0,this.spawnTime=.2,this.animationOffset=Math.random()*Math.PI*2,this.isPopping=!1,this.popStartTime=0,this.popDuration=.3}calculateRadius(t){return 50+t/Math.max(...n.map(t=>t.responses))*150}update(t){this.age+=t,this.updatePhysics(t),this.container.handleCollisions(this)}updatePhysics(t){if(this.isPopping){const t=(this.age-this.popStartTime)/this.popDuration;if(t>=1)return void(this.currentRadius=0);const e=1-Math.pow(t,2);return void(this.currentRadius=this.targetRadius*e)}if(this.age<this.spawnTime){const t=this.age/this.spawnTime,e=t<.7?Math.pow(t/.7,.5):1+.3*Math.sin((t-.7)/.3*Math.PI);this.currentRadius=this.targetRadius*e}else this.currentRadius=this.targetRadius;!this.isPopping&&this.age>.05&&(this.velocityY+=this.gravity,this.velocityX*=this.friction,this.velocityY*=this.friction,this.x+=this.velocityX*t*60,this.y+=this.velocityY*t*60)}startPop(){this.isPopping||(this.isPopping=!0,this.popStartTime=this.age)}isDestroyed(){return this.isPopping&&this.age-this.popStartTime>=this.popDuration}render(t,e){throw new Error("render method must be implemented in subclass")}hexToRgb(t){if(Array.isArray(t))return{r:255*t[0],g:255*t[1],b:255*t[2]};const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:128,g:128,b:128}}}e.exports={Bubble:o,ReasonBubble:class extends o{constructor(t,e){super(t,e),this.type="reason",this.color="#333333",this.gravity=.4,this.friction=.99}calculateRadius(t){return 50+t/Math.max(...n.map(t=>t.responses))*150}render(t,e){if(this.currentRadius<=0)return;const i=t.createRadialGradient(this.x-.3*this.currentRadius,this.y-.3*this.currentRadius,0,this.x,this.y,this.currentRadius);i.addColorStop(0,"#555555"),i.addColorStop(.7,"#333333"),i.addColorStop(1,"#111111"),t.beginPath(),t.arc(this.x,this.y,this.currentRadius,0,2*Math.PI),t.fillStyle=i,t.fill(),t.beginPath(),t.arc(this.x,this.y,this.currentRadius,0,2*Math.PI),t.strokeStyle="rgba(100, 100, 100, 0.6)",t.lineWidth=2,t.stroke(),t.beginPath(),t.arc(this.x-.3*this.currentRadius,this.y-.3*this.currentRadius,.25*this.currentRadius,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.3)",t.fill(),this.currentRadius>20&&this.age>this.spawnTime&&(t.fillStyle="#CCCCCC",t.font=`bold ${Math.min(40,this.currentRadius/4)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(this.word,this.x,this.y))}},EmotionBubble:class extends o{constructor(t,e){super(t,e),this.type="emotion",this.baseColor=t.color,this.color=this.hexToRgb(t.color),this.gravity=.3,this.friction=.99,this.spawnTime=.25}calculateRadius(t){return 60+t/Math.max(...s.map(t=>t.responses))*120}render(t,e){if(this.currentRadius<=0)return;const{r:i,g:n,b:s}=this.color,o=t.createRadialGradient(this.x-.4*this.currentRadius,this.y-.4*this.currentRadius,0,this.x,this.y,this.currentRadius),r=e+this.animationOffset,a=(Math.sin(2*r),this.baseColor),h=`rgb(${Math.floor(.6*i)}, ${Math.floor(.6*n)}, ${Math.floor(.6*s)})`,c=`rgba(${Math.floor(1.3*i)}, ${Math.floor(1.3*n)}, ${Math.floor(1.3*s)}, 0.8)`;o.addColorStop(0,c),o.addColorStop(.5,a),o.addColorStop(1,h),t.beginPath(),t.arc(this.x,this.y,this.currentRadius,0,2*Math.PI),t.fillStyle=o,t.fill();const u=.3*Math.sin(3*r)+.7;if(t.beginPath(),t.arc(this.x,this.y,this.currentRadius,0,2*Math.PI),t.strokeStyle=`rgba(${i}, ${n}, ${s}, ${u})`,t.lineWidth=3,t.stroke(),t.beginPath(),t.arc(this.x-.4*this.currentRadius,this.y-.4*this.currentRadius,.2*this.currentRadius,0,2*Math.PI),t.fillStyle="rgba(255, 255, 255, 0.8)",t.fill(),this.age>this.spawnTime)for(let i=0;i<3;i++){const n=2*e+this.animationOffset+i*(2*Math.PI/3),s=this.x+Math.cos(n)*this.currentRadius*.7,o=this.y+Math.sin(n)*this.currentRadius*.7,r=.5*Math.sin(4*e+i)+.5;t.fillStyle=`rgba(255, 255, 255, ${.6*r})`,t.beginPath(),t.arc(s,o,3,0,2*Math.PI),t.fill()}this.currentRadius>20&&this.age>this.spawnTime&&(t.fillStyle="#FFFFFF",t.font=`bold ${Math.min(40,this.currentRadius/4)}px Arial`,t.textAlign="center",t.textBaseline="middle",t.fillText(this.word,this.x,this.y))}},BubblePhysics:class{static checkCollisions(t){for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++){const n=t[e],s=t[i];if(n.age<.1||s.age<.1||n.isPopping||s.isPopping)continue;const o=s.x-n.x,r=s.y-n.y,a=Math.sqrt(o*o+r*r),h=n.currentRadius+s.currentRadius;if(a<h&&a>0){const t=h-a,e=o/a*t*.5,i=r/a*t*.5;n.x-=e,n.y-=i,s.x+=e,s.y+=i;const c=n.mass+s.mass,u=.5*(s.velocityX-n.velocityX),l=.5*(s.velocityY-n.velocityY);n.velocityX+=u*(s.mass/c),n.velocityY+=l*(s.mass/c),s.velocityX-=u*(n.mass/c),s.velocityY-=l*(n.mass/c)}}}static purgeBubbles(t){return t.forEach(t=>t.startPop()),t.filter(t=>!t.isDestroyed())}}}},{"../data/survey-data":3}],8:[function(t,e,i){(function(t){(function(){t.CANVAS_SKETCH_DEFAULT_STORAGE_KEY=window.location.href}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[4,8]);
//# sourceMappingURL=index.js.map
